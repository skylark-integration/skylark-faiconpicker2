/**
 * skylark-widgets-iconpicker - The skylark icon picker widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-iconpicker/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-query","skylark-widgets-base/Widget","./allIcons"],function(t,i,e,n,o){"use strict";var s={isElement:function(t){return e(t).length>0}},r=n.inherit({klassName:"IconPicker",pluginName:"lark.iconpicker",options:{title:!1,selected:!1,defaultValue:!1,placement:"bottom",collision:"none",animation:!0,hideOnSelect:!1,showFooter:!1,searchInFooter:!1,mustAccept:!1,selectedCustomClass:"bg-primary",icons:o,fullClassFormatter:function(t){return t},input:"input,.iconpicker-input",inputSearch:!1,container:!1,component:".input-group-addon,.iconpicker-component",templates:{popover:'<div class="iconpicker-popover popover"><div class="arrow"></div><div class="popover-title"></div><div class="popover-content"></div></div>',footer:'<div class="popover-footer"></div>',buttons:'<button class="iconpicker-btn iconpicker-btn-cancel btn btn-default btn-sm">Cancel</button> <button class="iconpicker-btn iconpicker-btn-accept btn btn-primary btn-sm">Accept</button>',search:'<input type="search" class="form-control iconpicker-search" placeholder="Type to filter" />',iconpicker:'<div class="iconpicker"><div class="iconpicker-items"></div></div>',iconpickerItem:'<a role="button" href="javascript:;" class="iconpicker-item"><i></i></a>'}},_init:function(){this.$element=e(this._elm).addClass("iconpicker-element"),this.options.originalPlacement=this.options.placement,this.container=!!s.isElement(this.options.container)&&e(this.options.container),!1===this.container&&(this.$element.is(".dropdown-toggle")?this.container=e("~ .dropdown-menu:first",this.$element):this.container=this.$element.is("input,textarea,button,.btn")?this.$element.parent():this.$element),this.container.addClass("iconpicker-container"),this.isDropdownMenu()&&(this.options.placement="inline"),this.input=!!this.$element.is("input,textarea")&&this.$element.addClass("iconpicker-input"),!1===this.input&&(this.input=this.container.find(this.options.input),this.input.is("input,textarea")||(this.input=!1)),this.component=this.isDropdownMenu()?this.container.parent().find(this.options.component):this.container.find(this.options.component),0===this.component.length?this.component=!1:this.component.find("i").addClass("iconpicker-component"),this._createPopover(),this._createIconpicker(),0===this.getAcceptButton().length&&(this.options.mustAccept=!1),this.isInputGroup()?this.container.parent().append(this.popover):this.container.append(this.popover),this._id=this.getUID(),this._bindElementEvents(),this._bindWindowEvents(),this.update(this.options.selected),this.isInline()&&this.show()},_createPopover:function(){this.popover=e(this.options.templates.popover);var t=this.popover.find(".popover-title");if(this.options.title&&t.append(e('<div class="popover-title-text">'+this.options.title+"</div>")),this.hasSeparatedSearchInput()&&!this.options.searchInFooter?t.append(this.options.templates.search):this.options.title||t.remove(),this.options.showFooter&&this.options.templates.footer){var i=e(this.options.templates.footer);this.hasSeparatedSearchInput()&&this.options.searchInFooter&&i.append(e(this.options.templates.search)),this.options.templates.buttons&&i.append(e(this.options.templates.buttons)),this.popover.append(i)}return!0===this.options.animation&&this.popover.addClass("fade"),this.popover},_createIconpicker:function(){var t=this;this.iconpicker=e(this.options.templates.iconpicker);var i=function(i){var n=e(this);n.is("i")&&(n=n.parent()),!1===t.options.mustAccept?(t.update(n.data("iconpickerValue")),t.emit("picked",{data:t.iconpickerValue})):t.update(n.data("iconpickerValue"),!0),t.options.hideOnSelect&&!1===t.options.mustAccept&&t.hide()},n=e(this.options.templates.iconpickerItem),o=[];for(var s in this.options.icons)if("string"==typeof this.options.icons[s].title){var r=n.clone();if(r.find("i").addClass(this.options.fullClassFormatter(this.options.icons[s].title)),r.data("iconpickerValue",this.options.icons[s].title).on("click.iconpicker",i),r.attr("title","."+this.options.icons[s].title),this.options.icons[s].searchTerms.length>0){for(var p="",c=0;c<this.options.icons[s].searchTerms.length;c++)p=p+this.options.icons[s].searchTerms[c]+" ";r.attr("data-search-terms",p)}o.push(r)}return this.iconpicker.find(".iconpicker-items").append(o),this.popover.find(".popover-content").append(this.iconpicker),this.iconpicker},_isEventInsideIconpicker:function(t){var i=e(t.target);return!((!i.hasClass("iconpicker-element")||i.hasClass("iconpicker-element")&&!i.is(this.$element))&&0===i.parents(".iconpicker-popover").length)},_bindElementEvents:function(){var t=this;this.getSearchInput().on("keyup.iconpicker",function(){t.filter(e(this).val().toLowerCase())}),this.getAcceptButton().on("click.iconpicker",function(){t.iconpicker.find(".iconpicker-selected").get(0);t.update(t.iconpickerValue),t.emit("picked",{data:t.iconpickerValue}),t.isInline()||t.hide()}),this.getCancelButton().on("click.iconpicker",function(){t.isInline()||t.hide()}),this.$element.on("focus.iconpicker",function(i){t.show(),i.stopPropagation()}),this.hasComponent()&&this.component.on("click.iconpicker",function(){t.toggle()}),this.hasInput()&&this.input.on("keyup.iconpicker",function(i){s.inArray(i.keyCode,[38,40,37,39,16,17,18,9,8,91,93,20,46,186,190,46,78,188,44,86])?t._updateFormGroupStatus(!1!==t.getValid(this.value)):t.update(),!0===t.options.inputSearch&&t.filter(e(this).val().toLowerCase())})},_bindWindowEvents:function(){var t=e(window.document),i=this,n=".iconpicker.inst"+this._id;e(window).on("resize.iconpicker"+n+" orientationchange.iconpicker"+n,function(t){i.popover.hasClass("in")&&i.updatePlacement()}),i.isInline()||t.on("mouseup"+n,function(t){i._isEventInsideIconpicker(t)||i.isInline()||i.hide()})},_unbindElementEvents:function(){this.popover.off(".iconpicker"),this.$element.off(".iconpicker"),this.hasInput()&&this.input.off(".iconpicker"),this.hasComponent()&&this.component.off(".iconpicker"),this.hasContainer()&&this.container.off(".iconpicker")},_unbindWindowEvents:function(){e(window).off(".iconpicker.inst"+this._id),e(window.document).off(".iconpicker.inst"+this._id)},updatePlacement:function(t,n){t=t||this.options.placement,this.options.placement=t,n=!0===(n=n||this.options.collision)?"flip":n;var o={at:"right bottom",my:"right top",of:this.hasInput()&&!this.isInputGroup()?this.input:this.container,collision:!0===n?"flip":n,within:window};if(this.popover.removeClass("inline topLeftCorner topLeft top topRight topRightCorner rightTop right rightBottom bottomRight bottomRightCorner bottom bottomLeft bottomLeftCorner leftBottom left leftTop"),"object"==typeof t)return this.popover.position(i.extend({},o,t));switch(t){case"inline":o=!1;break;case"topLeftCorner":o.my="right bottom",o.at="left top";break;case"topLeft":o.my="left bottom",o.at="left top";break;case"top":o.my="center bottom",o.at="center top";break;case"topRight":o.my="right bottom",o.at="right top";break;case"topRightCorner":o.my="left bottom",o.at="right top";break;case"rightTop":o.my="left bottom",o.at="right center";break;case"right":o.my="left center",o.at="right center";break;case"rightBottom":o.my="left top",o.at="right center";break;case"bottomRightCorner":o.my="left top",o.at="right bottom";break;case"bottomRight":o.my="right top",o.at="right bottom";break;case"bottom":o.my="center top",o.at="center bottom";break;case"bottomLeft":o.my="left top",o.at="left bottom";break;case"bottomLeftCorner":o.my="right top",o.at="left bottom";break;case"leftBottom":o.my="right top",o.at="left center";break;case"left":o.my="right center",o.at="left center";break;case"leftTop":o.my="right bottom",o.at="left center";break;default:return!1}return this.popover.css({display:"inline"===this.options.placement?"":"block"}),!1!==o?this.popover.position(o).css("maxWidth",e(window).width()-this.container.offset().left-5):this.popover.css({top:"auto",right:"auto",bottom:"auto",left:"auto",maxWidth:"none"}),this.popover.addClass(this.options.placement),!0},_updateComponents:function(){if(this.iconpicker.find(".iconpicker-item.iconpicker-selected").removeClass("iconpicker-selected "+this.options.selectedCustomClass),this.iconpickerValue&&this.iconpicker.find("."+this.options.fullClassFormatter(this.iconpickerValue).replace(/ /g,".")).parent().addClass("iconpicker-selected "+this.options.selectedCustomClass),this.hasComponent()){var t=this.component.find("i");t.length>0?t.attr("class",this.options.fullClassFormatter(this.iconpickerValue)):this.component.html(this.getHtml())}},_updateFormGroupStatus:function(t){return!!this.hasInput()&&(!1!==t?this.input.parents(".form-group:first").removeClass("has-error"):this.input.parents(".form-group:first").addClass("has-error"),!0)},getValid:function(t){i.isString(t)||(t="");var e=""===t;t=i.trim(t);for(var n=!1,o=0;o<this.options.icons.length;o++)if(this.options.icons[o].title===t){n=!0;break}return!(!n&&!e)&&t},setValue:function(t){var i=this.getValid(t);return!1!==i&&(this.iconpickerValue=i,this.iconpickerValue)},getHtml:function(){return'<i class="'+this.options.fullClassFormatter(this.iconpickerValue)+'"></i>'},setSourceValue:function(t){return!1!==(t=this.setValue(t))&&""!==t&&(this.hasInput()?this.input.val(this.iconpickerValue):this.$element.data("iconpickerValue",this.iconpickerValue)),t},getSourceValue:function(t){var i=t=t||this.options.defaultValue;return void 0!==(i=this.hasInput()?this.input.val():this.$element.data("iconpickerValue"))&&""!==i&&null!==i&&!1!==i||(i=t),i},hasInput:function(){return!1!==this.input},isInputSearch:function(){return this.hasInput()&&!0===this.options.inputSearch},isInputGroup:function(){return this.container.is(".input-group")},isDropdownMenu:function(){return this.container.is(".dropdown-menu")},hasSeparatedSearchInput:function(){return!1!==this.options.templates.search&&!this.isInputSearch()},hasComponent:function(){return!1!==this.component},hasContainer:function(){return!1!==this.container},getAcceptButton:function(){return this.popover.find(".iconpicker-btn-accept")},getCancelButton:function(){return this.popover.find(".iconpicker-btn-cancel")},getSearchInput:function(){return this.popover.find(".iconpicker-search")},filter:function(t){if(t){var i=[];return this.iconpicker.find(".iconpicker-item").each(function(){var n=e(this),o=n.attr("title").toLowerCase();o=o+" "+(n.attr("data-search-terms")?n.attr("data-search-terms").toLowerCase():"");var s=!1;try{s=new RegExp("(^|\\W)"+t,"g")}catch(t){s=!1}!1!==s&&o.match(s)?(i.push(n),n.show()):n.hide()}),i}return this.iconpicker.find(".iconpicker-item").show(),e(!1)},show:function(){if(this.popover.hasClass("in"))return!1;r.batch(e(".iconpicker-popover.in:not(.inline)").not(this.popover),"hide"),this.updatePlacement(),this.popover.addClass("in"),setTimeout(i.proxy(function(){this.popover.css("display",this.isInline()?"":"block")},this),this.options.animation?300:1)},hide:function(){if(!this.popover.hasClass("in"))return!1;this.popover.removeClass("in"),setTimeout(i.proxy(function(){this.popover.css("display","none"),this.getSearchInput().val(""),this.filter("")},this),this.options.animation?300:1)},toggle:function(){this.popover.is(":visible")?this.hide():this.show(!0)},update:function(t,i){return t=t||this.getSourceValue(this.iconpickerValue),!0===i?t=this.setValue(t):(t=this.setSourceValue(t),this._updateFormGroupStatus(!1!==t)),!1!==t&&this._updateComponents(),t},destroy:function(){this.$element.removeData("iconpicker").removeData("iconpickerValue").removeClass("iconpicker-element"),this._unbindElementEvents(),this._unbindWindowEvents(),e(this.popover).remove()},disable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!0),!0)},enable:function(){return!!this.hasInput()&&(this.input.prop("disabled",!1),!0)},isDisabled:function(){return!!this.hasInput()&&!0===this.input.prop("disabled")},isInline:function(){return"inline"===this.options.placement||this.popover.hasClass("inline")}});return r.batch=function(t,i){var n=Array.prototype.slice.call(arguments,2);return e(t).each(function(){var t=e(this).plugin("lark.iconpicker");t&&t[i].apply(t,n)})},t.attach("iwidgets.IconPicker",r)});
//# sourceMappingURL=sourcemaps/IconPicker.js.map
